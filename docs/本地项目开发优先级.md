# 本地视频录制和OCR识别项目开发优先级

## 项目概述

**项目名称**：sap-message-capture  
**项目类型**：本地Python程序  
**主要功能**：从微信/QQ APP窗口录制视频，OCR识别消息，解析需求信息，同步到CloudBase

## 开发优先级（按阶段）

### 阶段1：项目基础搭建（优先级：最高）

1. ✅ **创建本地项目结构**
   - 创建项目目录 `sap-message-capture/`
   - 创建模块目录结构
   - 创建配置文件 `config.py`
   - 创建依赖文件 `requirements.txt`
   - 创建README文档

2. ✅ **环境配置**
   - Python环境（3.8+）
   - 安装Tesseract OCR
   - 安装Python依赖包

### 阶段2：核心功能开发（优先级：高）

3. **屏幕录制模块** (`modules/screen_recorder.py`)
   - 窗口自动定位（win32gui）
   - 窗口最大化功能
   - 窗口状态检测
   - 登录状态检测
   - 定时录制功能
   - 视频保存

4. **视频处理模块** (`modules/video_processor.py`)
   - 关键帧提取
   - 画面变化检测
   - 消息区域识别
   - 图片保存

5. **OCR识别模块** (`modules/ocr_recognizer.py`)
   - Tesseract OCR集成
   - 图像预处理（灰度化、二值化、去噪）
   - 多策略识别（不同PSM模式）
   - 结果后处理
   - 准确率评估

### 阶段3：数据处理和优化（优先级：中）

6. **本地缓存模块** (`modules/local_cache.py`)
   - SQLite数据库管理
   - 消息去重检查
   - OCR结果缓存
   - 发布者缓存

7. **时间提取模块** (`modules/time_extractor.py`)
   - 从OCR文本提取时间
   - 从UI元素识别时间
   - 时间范围过滤

8. **用户信息提取模块** (`modules/user_info_extractor.py`)
   - QQ号/微信号提取
   - 昵称提取
   - 头像提取

9. **发布者管理模块** (`modules/provider_manager.py`)
   - 发布者查找（本地缓存优先）
   - 发布者创建/更新
   - 去重逻辑

### 阶段4：消息解析和同步（优先级：中）

10. **消息解析模块** (`modules/message_parser.py`)
    - 消息边界识别
    - 元数据提取
    - 需求解析（复用现有逻辑）
    - 集成时间过滤、用户信息提取、发布者管理

11. **CloudBase同步模块** (`modules/cloudbase_sync.py`)
    - 发布者同步到云端
    - 需求数据同步到云端
    - 头像上传到云存储

12. **增量同步模块** (`modules/sync_manager.py`)
    - 批量同步未同步的消息
    - 同步失败重试机制

### 阶段5：测试和优化（优先级：中低）

13. **功能测试**
    - 屏幕录制功能测试
    - OCR识别准确率测试
    - 消息解析准确率测试
    - 同步功能测试

14. **性能优化**
    - OCR识别速度优化
    - 缓存命中率优化
    - 内存使用优化

15. **准确率优化**
    - 图像预处理优化
    - OCR参数调优
    - 如果准确率<70%，考虑启用云端OCR

## 当前开发状态

- ✅ 项目规划完成
- ✅ 开发优先级确定
- ✅ **项目基础搭建完成**
- ✅ **屏幕录制模块完成** - 窗口定位、最大化、视频录制
- ✅ **视频处理模块完成** - 关键帧提取、画面变化检测
- ✅ **OCR识别模块完成** - Tesseract OCR集成、图像预处理、多策略识别
- ✅ **本地缓存模块完成** - SQLite数据库管理、消息去重、OCR缓存、发布者缓存
- ✅ **时间提取模块完成** - 时间识别、时间范围过滤
- ✅ **用户信息提取模块完成** - QQ号/微信号/昵称提取、头像提取
- ✅ **发布者管理模块完成** - 发布者查找、创建/更新、去重逻辑
- ✅ **消息解析模块完成** - 消息边界识别、元数据提取、集成所有功能
- ✅ **CloudBase同步模块完成** - 云端同步框架（待实现具体API调用）
- ✅ **增量同步模块完成** - 批量同步、重试机制
- ✅ **主程序集成完成** - 完整流程集成

## 技术栈

- **Python 3.8+**
- **Tesseract OCR**（本地OCR，免费）
- **OpenCV**（图像处理）
- **PyWin32**（Windows窗口操作）
- **MSS**（屏幕截图）
- **SQLite**（本地缓存）
- **CloudBase Python SDK**（云端同步）

## 依赖包

```
opencv-python>=4.8.0
pytesseract>=0.3.10
pywin32>=306
mss>=9.0.1
Pillow>=10.0.0
numpy>=1.24.0
schedule>=1.2.0
tencentcloud-sdk-python>=3.0.0
```

## 下一步行动

1. 创建本地项目目录结构
2. 创建配置文件和依赖文件
3. 开发屏幕录制模块（核心功能）
4. 开发视频处理模块
5. 开发OCR识别模块

