---
name: sap-demand-site-mvp-v2
overview: 在原有 SAP 顾问需求网站 MVP 方案基础上，补充顶部多条件筛选和带积分解锁的联系方式展示设计，并保持实现路径对非程序员友好。
todos:
  - id: choose-baas
    content: 确定并选择一个适合中国区访问的 BaaS/低代码平台（支持账号密码登录 + 数据表 + REST/JS SDK）
    status: pending
  - id: design-pages
    content: 基于现有站点结构设计并列出需要新增的页面及其大致布局（需求广场、详情、登录注册、个人中心）
    status: pending
  - id: define-schema
    content: 在选定平台中创建用户、模块、需求、评论、私信和积分字段等数据表，并配置基础字段与关系（含 provider_user_id 与联系方式字段）
    status: pending
    dependencies:
      - choose-baas
  - id: frontend-skeleton
    content: 在当前项目中新建对应 HTML 页面并搭建页面骨架（导航、顶部筛选条、卡片列表占位、联系方式区域占位）
    status: pending
    dependencies:
      - design-pages
  - id: integrate-sdk
    content: 在前端通过公共 JS 文件封装登录、拉取需求、发布需求、评论、私信、积分更新与联系方式读取等 API 调用
    status: pending
    dependencies:
      - choose-baas
      - frontend-skeleton
  - id: wire-flows
    content: 将页面表单、筛选控件和卡片展示与对应 JS 函数打通，实现筛选、自动打标签录入和联系方式解锁的完整流程
    status: pending
    dependencies:
      - integrate-sdk
  - id: basic-security
    content: 配置后端表权限规则（包括联系方式字段的读取控制），并在前端增加简单输入校验与查看次数限制的预留
    status: pending
    dependencies:
      - wire-flows
---

# SAP 顾问需求网站 MVP（卡片展示 + 顶部筛选 + 联系方式解锁）方案 v2

## 一、整体目标回顾

- **核心目标**: 将微信群/QQ群里的 SAP 顾问需求以「卡片式」展示在网站上，每条卡片包含：原始文本 + 自动打上的标签（模块、城市、周期、年限、语言、价格等）+ 信息提供者联系方式模块（头像+微信/QQ 号），联系方式需要用户注册并达到一定积分才能解锁查看。
- **交互风格**: 参考你给的 SAP Fiori 风格界面：上方是模块/条件的 Tab 和筛选条，下方是结构化信息卡片，整体偏简洁、专业、留白多的 Apple 风。

## 二、卡片与顶部筛选设计

### 1. 顶部筛选区

- **筛选条件（均为前端即时过滤）**
- 按 SAP 模块：下拉或 Tab（FICO、MM、SD、PP、WM/EWM、HR、SAC、BI、ABAP、其他）。
- 按城市/地点：城市下拉（含“远程”“海外”选项）。
- 按远程/现场：单选或多选（全部 / 仅远程 / 仅现场）。
- 按语言：`英语流利` / `英文简单沟通` / `日语流利` / 其他。
- 按年限区间：例如下拉 `0-3年`、`3-5年`、`5-8年`、`8年以上`（基于 `years_min` 字段）。
- 按项目周期：例如 `≤3个月`、`3-6个月`、`6个月以上`（基于 `duration_months_estimated`）。
- 按价格：第一版先保留字段 `price_text`，以后如果你明确价格区间再做数值化筛选。
- **前端过滤模式**
- 初次加载时从后端拉取一批需求数据（分页或按时间窗口），缓存在浏览器中。
- 修改筛选条件时，只在前端 JS 中过滤已有数据，实时刷新下方卡片，减少对后端的依赖，操作更流畅。

### 2. 需求卡片结构

- **A. 原始信息区**
- 完整显示从微信群/QQ群抓取到的 **原始文本**（`raw_text`），不改写，只做分行处理。
- **B. 标签区（结构化信息）**
- 模块：一个或多个彩色标签，例如 `FICO` `MM`。
- 城市/地点：`上海` / `远程` / `海外`。
- 周期：从 `duration_text` 中提炼的简短展示，如 `4个月`，估算不到则显示原文。
- 年限：展示 `years_text`（如“5年经验”“10年以上”）。
- 语言：如 `英语流利` `日语流利` 标签。
- 价格：展示 `price_text`（若能从原文中识别）。
- 创建时间：`captured_at`（抓取进系统的时间）。
- 截止时间：`deadline`（能解析则显示；否则不显示或标“截止时间未标明”）。
- **C. 信息提供者区（联系方式 + 解锁逻辑）**
- 位置：卡片底部或右下角的一个小区域。
- 默认状态（未达到积分要求或未登录）：
- 显示：
- 一张**模糊/占位头像 SVG 图标**（例如圆形灰色头像，中心一个小锁图标）。
- 文案：`信息来自：某某用户`（昵称），旁边显示小锁：`积分达到 X 后可解锁微信/QQ`。
- 微信/QQ 账号文本区域以灰色块或“***”形式打马赛克。
- 点击该区域：弹出提示对话框 → 说明需要注册/登录 + 积分规则 + 当前积分/差多少分解锁。
- 解锁状态（已登录且积分达到阈值）：
- 显示：
- 真实头像（由信息提供者上传，或使用默认头像）。
- 微信号/QQ 号明文展示（可复制）。
- 保护提示：`请勿滥用联系方式，如被举报会收回查看权限`。

## 三、数据模型扩展（联系方式 + 积分）

### 1. `users` 用户表扩展

在原有用户表基础上增加：

- `avatar_url`: 头像图片地址（可选）。
- `wechat_id`: 微信号（信息提供者自愿填写，默认不公开）。
- `qq_id`: QQ 号（同上）。
- `points`: 当前积分值（整数，默认 0）。
- `can_share_contact`: 是否愿意展示联系方式（布尔，默认 false）。

### 2. `demands` 需求表扩展

- `provider_user_id`: 该条信息的提供者用户 ID（外键到 `users.id`），用于在卡片上展示头像和解锁联系方式。
- 已有的结构化标签字段保持不变：
- `module_codes`, `city`, `is_remote`, `is_overseas`,
- `duration_text`, `duration_months_estimated`,
- `price_text`,
- `years_text`, `years_min`,
- `language_tags`, `deadline`,
- `raw_text`, `source_channel`, `captured_at` 等。

### 3. 积分规则（第一版简单实现）

- **积分字段**：`users.points`。
- **加分事件示例**（可在后端/BaaS 里用触发器或者前端调用 API 实现）：
- 注册成功：+10 分。
- 完善个人资料（包括填写擅长模块/城市）：+10 分。
- 发布一条需求（被你审核通过）：+5 分。
- 发表有价值评论（暂时由你人工判断并在后台打分，先不自动化）：+1～5 分。
- **解锁门槛**：
- 例如要求 `points >= 30` 才能查看联系方式。
- 门槛值设置为全局常量，方便后期调整。

## 四、前端逻辑设计（和筛选/解锁配合）

### 1. 筛选与卡片更新

- 页面加载：一次性拉取最近一段时间的需求数据（如近 3 个月 / 最近 N 条）。
- 将数据缓存到 JS 变量中，例如 `allDemands`。
- 顶部每个筛选控件的变更都会触发一个 `applyFilters()` 函数：
- 根据当前筛选条件过滤 `allDemands`，得到 `filteredDemands`。
- 重新渲染卡片列表区域，只展示 `filteredDemands`。
- 模块 Tab 与筛选条联动：
- 点击模块 Tab 相当于修改 `module` 筛选条件，并触发 `applyFilters()`。

### 2. 联系方式解锁判断

前端在渲染卡片时，根据当前用户登录状态及积分决定展示内容：

- 从登录状态中获取 `currentUser`，若为空 → 视为未登录。
- 若未登录：
- 所有卡片的联系方式区域都显示锁定状态（模糊头像+解锁提示），点击时弹出登录/注册提醒。
- 若已登录：
- 读取 `currentUser.points`：
- 若 `< threshold`：同样显示锁定状态，但解锁提示中增加“当前积分：X / 30”。
- 若 `>= threshold`：展示真实头像与微信/QQ 信息（如果该 `provider_user_id` 用户选择了 `can_share_contact = true`）。

## 五、自动打标签与后台录入配合

- 保持之前“粘贴原文 → 自动打标签 → 人工校对 → 保存”的流程不变；
- 在后台录入时，
- 选择“信息提供者”下拉（或直接默认当前登录用户为 `provider_user_id`）；
- 信息提供者可以在自己的个人中心页面中填写/更新微信/QQ 号，并勾选是否允许展示；
- 保存时将 `provider_user_id` 一起存入 `demands` 表。

## 六、页面结构调整总结

在原计划的基础上，前端页面的关键模块将包含：

- `sap-demand.html`（需求广场页）
- 顶部筛选条 + 模块 Tab。
- 下方卡片列表：每张卡片含原文区、标签区、信息提供者区（带解锁逻辑）。
- `sap-demand-detail.html`（详情页）
- 在详情信息区域重复展示联系方式模块，并复用相同积分判定逻辑。
- `user-center.html`（个人中心）
- 增加“我的积分”和“联系方式设置”区块：上传头像、填写微信/QQ、勾选是否允许展示。

## 七、后续可迭代方向

- 更精细的价格结构化与按价格筛选；
- 更智能的 NLP 解析（减少人工校对时间）；
- 联系方式查看记录与风控（例如限制每天查看次数、防止批量爬取）；
- 允许信息提供者配置“只对某些模块/城市顾问开放联系方式”等更细规则。