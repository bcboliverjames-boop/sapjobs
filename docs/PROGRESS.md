# 项目开发进度

## 项目概述

**项目名称**: SAP 顾问需求网站  
**技术栈**: UniApp + Vue 3 + TypeScript + CloudBase  
**环境ID**: cloud1-2g93n7qgab878d25  
**最后更新**: 2025-12-19

## 云服务器 / MCP 参数（供自动化运维使用）

- **Tencent Region**: `ap-nanjing`
- **Tencent InstanceId**: `ins-f4ov0dk8`
- **sapboss-api (3000) ADMIN_UIDS**: `acc_0619a066b2c157bc8fd654c24a19ef5d`

## 开发阶段

### ✅ 阶段1：需求展示功能（已完成）

#### 1.1 需求列表页 (`pages/demand/demand.vue`)
- ✅ 卡片式展示需求信息
- ✅ 多条件筛选功能：
  - 模块筛选（FICO、MM、SD、PP、WM/EWM、HR、SAC、BI、ABAP、其他）
  - 城市筛选（支持"全部"、"远程"等）
  - 工作方式筛选（全部/仅远程/仅现场）
  - 年限筛选（0-3年、3-5年、5-8年、8年以上）
  - 周期筛选（短期≤3个月、中期3-6个月、长期6个月以上）
  - 语言筛选（英语、日语）
- ✅ 每条需求显示热门评论预览（横向滚动，最多10条，按点赞数排序）
- ✅ 点击评论文字跳转到详情页
- ✅ 在列表页直接点赞/踩评论

#### 1.2 需求详情页 (`pages/demand/detail.vue`)
- ✅ 显示完整原始需求文本
- ✅ 结构化信息标签展示（模块、城市、周期、年限、语言等）
- ✅ 信息提供者展示区域（含积分解锁提示）
- ✅ 评论提交区域固定在顶部，方便用户提交

### ✅ 阶段2：评论互动功能（已完成）

#### 2.1 评论功能
- ✅ 评论展示和提交
- ✅ 点赞/踩功能
- ✅ 评论排序逻辑：
  - 新评论（5分钟内）显示在最前面
  - 有新回复的评论（5分钟内有新回复）显示在第二位
  - 其他评论按点赞数降序排序

#### 2.2 回复功能
- ✅ 支持对评论的回复
- ✅ 回复列表展示（嵌套显示）
- ✅ 回复输入框默认隐藏，点击"回复"按钮后显示
- ✅ 回复提交后不重新排序，保持评论位置稳定
- ✅ 回复立即显示在当前评论下方

#### 2.3 UI 优化
- ✅ 评论提交区域固定在顶部，方便用户提交
- ✅ 回复输入框按需显示，界面更简洁
- ✅ "回复"按钮使用深蓝色（#1e40af），提示可点击

## 数据库集合

### 已创建的集合
- ✅ `sap_demands_raw` - 原始需求数据
- ✅ `sap_demand_comments` - 需求评论
- ✅ `sap_comment_replies` - 评论回复
- ✅ `users` - 用户资料（含积分信息）
- ✅ `sap_demand_favorites` - 需求收藏记录
- ✅ `messages` - 私信记录

### 集合字段说明

#### `sap_demands_raw`
- `raw_text` - 原始需求文本
- `module_codes` - 模块代码数组
- `city` - 城市
- `duration_text` - 周期文本
- `years_text` - 年限文本
- `language` - 语言要求
- `provider_name` - 信息提供者名称

#### `sap_demand_comments`
- `demand_id` - 需求ID
- `content` - 评论内容
- `nickname` - 评论者昵称
- `likes` - 点赞数
- `dislikes` - 踩数
- `createdAt` - 创建时间

#### `sap_comment_replies`
- `comment_id` - 评论ID
- `demand_id` - 需求ID
- `content` - 回复内容
- `nickname` - 回复者昵称
- `createdAt` - 创建时间

#### `users`
- `points` - 积分
- `nickname` - 昵称
- `expertise` - 擅长领域
- `yearsOfExperience` - 工作经验年限
- `wechatId` - 微信号
- `qqId` - QQ号
- `shareContact` - 是否分享联系方式

## 工具函数

### 已实现的工具函数
- ✅ `src/utils/cloudbase.ts` - CloudBase SDK 初始化和认证
- ✅ `src/utils/sap-demands.ts` - SAP 需求数据管理
  - `fetchSapDemandsFromCloud()` - 从云端获取需求列表
  - `fetchSapDemandById()` - 根据ID获取需求详情
  - `seedSampleDemandsToCloud()` - 导入示例数据
- ✅ `src/utils/user.ts` - 用户资料管理
  - `getOrCreateUserProfile()` - 获取或创建用户资料
  - `updateUserProfile()` - 更新用户资料
- ✅ `src/utils/comment-replies.ts` - 评论回复管理
  - `fetchRepliesByCommentId()` - 获取评论的回复列表
  - `addReply()` - 添加回复
- ✅ `src/utils/points-config.ts` - 积分系统配置
  - `getPointsConfig()` - 获取积分配置
  - `getRewardPoints()` - 获取积分奖励值
  - `getThresholdPoints()` - 获取积分门槛值
- ✅ `src/utils/favorites.ts` - 收藏功能管理
  - `addFavorite()` - 添加收藏
  - `removeFavorite()` - 取消收藏
  - `isFavorite()` - 检查是否已收藏
  - `checkFavoritesStatus()` - 批量检查收藏状态
- ✅ `src/utils/messages.ts` - 私信功能管理
  - `sendMessage()` - 发送私信
  - `getConversations()` - 获取对话列表
  - `getMessagesWithUser()` - 获取与指定用户的对话消息
  - `getUnreadCount()` - 获取未读消息数量

## 待实现功能

### 🚧 阶段3：用户系统（部分完成）
- ✅ 用户登录/注册系统（基础框架完成，80%）
- ✅ 积分系统完整实现（100%）
  - ✅ 积分配置化（所有积分规则可配置）
  - ✅ 注册成功：+10 分（可配置）
  - ✅ 完善个人资料：+10 分（可配置，仅首次）
  - ✅ 发布需求：+5 分（可配置）
  - ✅ 发表评论：+1 分（可配置）
  - ✅ 评论被点赞：+1 分/次（可配置）
- ✅ 联系方式解锁功能（100%）
  - ✅ 根据积分判断是否解锁
  - ✅ 显示真实联系方式（微信、QQ）
  - ✅ 联系方式复制功能
  - ✅ 解锁提示对话框
- ✅ 个人中心页面优化（100%）
  - ✅ Tab 切换功能（我的资料、我发布的需求、我的评论、我的收藏）
  - ✅ 我发布的需求列表
  - ✅ 我的评论列表
  - ✅ 我的收藏列表

### ✅ 阶段4：高级功能（已完成）
- ✅ 需求发布功能（100%）
  - ✅ 需求发布页面和表单
  - ✅ 需求发布API和数据保存
  - ✅ 发布成功后自动加分
- ✅ 私信功能（100%）
  - ✅ 私信列表页面
  - ✅ 私信聊天页面
  - ✅ 发送和接收私信
  - ✅ 未读消息计数
  - ✅ 在需求详情页添加"发送私信"按钮
- ✅ 需求搜索功能（100%）
  - ✅ 搜索输入框
  - ✅ 关键词搜索（搜索需求内容、模块、城市等）
  - ✅ 实时过滤结果
- ✅ 需求收藏功能（100%）
  - ✅ 收藏/取消收藏功能
  - ✅ 收藏状态显示
  - ✅ 我的收藏列表

## 已知问题

1. 回复提交后需要等待300ms才能查询到数据（已优化，但可能仍有延迟）
2. 评论排序逻辑在页面刷新时会重新计算（符合预期）

## 技术债务

1. 需要优化评论和回复的实时更新机制
2. 需要添加错误处理和用户提示优化
3. 需要添加数据分页加载，避免一次性加载过多数据

## 下一步计划

1. ✅ 完善用户登录/注册系统（基础完成）
2. ✅ 实现积分系统（加分规则、解锁逻辑）- 已完成
3. ✅ 实现联系方式解锁功能 - 已完成
4. ✅ 实现需求发布功能 - 已完成
5. ✅ 优化个人中心页面（添加"我发布的需求"、"我的评论"等Tab）- 已完成
6. ✅ 实现私信功能 - 已完成
7. ✅ 实现需求搜索功能 - 已完成
8. ✅ 实现需求收藏功能 - 已完成

## 项目完成度

**总体完成度**: 约 95%

### 核心功能完成情况
- ✅ 需求展示：100%
- ✅ 评论互动：100%
- ✅ 用户系统：90%（基础功能完成，部分优化待完善）
- ✅ 积分系统：100%
- ✅ 联系方式解锁：100%
- ✅ 需求发布：100%
- ✅ 个人中心优化：100%
- ✅ 私信功能：100%
- ✅ 搜索功能：100%
- ✅ 收藏功能：100%

## 最新更新（2025-12-18）

### ✅ 已完成的功能

1. **积分配置化系统**
   - 创建了 `src/utils/points-config.ts` 配置文件
   - 所有积分规则（奖励、消耗、门槛）都可配置
   - 默认配置值：
     - 注册：+10 分
     - 完善资料：+10 分
     - 发布需求：+5 分
     - 发表评论：+1 分
     - 评论被点赞：+1 分/次
     - 查看联系方式门槛：30 分

2. **联系方式解锁功能**
   - 从需求数据获取发布者信息
   - 根据积分和 `can_share_contact` 判断是否显示联系方式
   - 已解锁：显示真实联系方式（微信、QQ），支持一键复制
   - 未解锁：显示锁定状态和提示，点击显示积分规则对话框
   - 优化了UI展示（头像、保护提示等）

3. **需求发布功能**
   - 创建了需求发布页面 `pages/demand/publish.vue`
   - 支持填写需求原文、模块、城市、工作方式、周期、年限、语言等
   - 发布成功后自动保存到数据库并给用户加分
   - 在需求列表页添加了"发布"按钮

4. **个人中心页面优化**
   - 添加了 Tab 切换功能（我的资料、我发布的需求、我的评论、我的收藏）
   - 实现了"我发布的需求"Tab，显示当前用户发布的所有需求
   - 实现了"我的评论"Tab，显示当前用户的所有评论和回复
   - 实现了"我的收藏"Tab，显示收藏的需求列表
   - 支持点击列表项跳转到详情页

5. **收藏功能**
   - 创建了收藏工具函数 `src/utils/favorites.ts`
   - 在需求详情页添加了收藏按钮
   - 支持收藏/取消收藏操作
   - 收藏状态实时显示
   - 个人中心"我的收藏"Tab 显示收藏列表

6. **搜索功能**
   - 在需求列表页添加了搜索输入框
   - 支持关键词搜索（搜索需求内容、模块、城市等）
   - 实时过滤搜索结果
   - 支持清除搜索

7. **私信功能**
   - 创建了私信工具函数 `src/utils/messages.ts`
   - 创建了私信列表页面 `pages/message/list.vue`
   - 创建了私信聊天页面 `pages/message/chat.vue`
   - 在需求详情页添加了"发送私信"按钮（已解锁联系方式时显示）
   - 支持发送和接收私信
   - 支持未读消息计数和标记已读


