<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>节假日数据验证</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
    .country-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    .year-section { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
    .status { font-weight: bold; margin: 5px 0; }
    .match { color: green; }
    .missing { color: red; }
    .warning { color: orange; }
    .holiday-list { margin: 10px 0; padding-left: 20px; }
    .holiday-item { margin: 3px 0; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px 5px; }
    .loading { display: none; }
  </style>
</head>
<body>
  <h1>节假日数据验证工具</h1>
  <p>对比代码中的硬编码节假日数据与Nager.Date API的真实数据</p>
  
  <button onclick="startVerification()">开始验证</button>
  <div id="results"></div>

  <script>
    const countries = [
      { name: 'us', code: 'US', displayName: '美国' },
      { name: 'germany', code: 'DE', displayName: '德国' },
      { name: 'japan', code: 'JP', displayName: '日本' },
      { name: 'singapore', code: 'SG', displayName: '新加坡' }
    ];

    const years = [2025, 2026];

    const HOLIDAY_CONFIG = {
      us: {
        recurring: [
          { date: '01-01', label: 'New Year\'s Day' },
          { date: '01-20', label: 'MLK Day' },
          { date: '02-17', label: 'Presidents\' Day' },
          { date: '05-26', label: 'Memorial Day' },
          { date: '07-04', label: 'Independence Day' },
          { date: '09-01', label: 'Labor Day' },
          { date: '11-27', label: 'Thanksgiving' },
          { date: '11-28', label: 'Thanksgiving' },
          { date: '12-25', label: 'Christmas' }
        ]
      },
      germany: {
        recurring: [
          { date: '01-01', label: 'New Year\'s Day' },
          { date: '05-01', label: 'Labour Day' },
          { date: '10-03', label: 'German Unity Day' },
          { date: '12-25', label: 'Christmas Day' },
          { date: '12-26', label: 'Boxing Day' }
        ]
      },
      japan: {
        recurring: [
          { date: '01-01', label: 'New Year\'s Day' },
          { date: '02-11', label: 'National Foundation Day' },
          { date: '04-29', label: 'Showa Day' },
          { date: '05-03', label: 'Constitution Memorial Day' },
          { date: '05-04', label: 'Greenery Day' },
          { date: '05-05', label: 'Children\'s Day' },
          { date: '08-11', label: 'Mountain Day' },
          { date: '11-03', label: 'Culture Day' },
          { date: '11-23', label: 'Labour Thanksgiving Day' },
          { date: '12-23', label: 'Emperor\'s Birthday' }
        ]
      },
      singapore: {
        recurring: [
          { date: '01-01', label: 'New Year\'s Day' },
          { date: '05-01', label: 'Labour Day' },
          { date: '08-09', label: 'National Day' },
          { date: '12-25', label: 'Christmas Day' }
        ]
      }
    };

    function expandRecurringHolidays(config, year) {
      const holidays = [];
      if (config.recurring) {
        config.recurring.forEach(({ date, label }) => {
          const [month, day] = date.split('-').map(Number);
          const fullDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          holidays.push({ date: fullDate, label });
        });
      }
      if (config.yearSpecific && config.yearSpecific[year]) {
        config.yearSpecific[year].forEach(({ date, label }) => {
          holidays.push({ date, label });
        });
      }
      return holidays.sort((a, b) => a.date.localeCompare(b.date));
    }

    async function fetchHolidaysFromAPI(countryCode, year) {
      const url = `https://date.nager.at/api/v3/PublicHolidays/${year}/${countryCode}`;
      try {
        const response = await fetch(url);
        if (response.ok) {
          const data = await response.json();
          return data.map(item => ({
            date: item.date,
            label: item.localName || item.name
          })).sort((a, b) => a.date.localeCompare(b.date));
        }
      } catch (error) {
        console.error(`Error fetching ${countryCode} ${year}:`, error);
      }
      return null;
    }

    function compareHolidays(codeHolidays, apiHolidays) {
      const codeDates = new Set(codeHolidays.map(h => h.date));
      const apiDates = new Set(apiHolidays.map(h => h.date));
      
      const missingInCode = apiHolidays.filter(h => !codeDates.has(h.date));
      const missingInAPI = codeHolidays.filter(h => !apiDates.has(h.date));
      const matching = codeHolidays.filter(h => apiDates.has(h.date));
      
      return { matching, missingInCode, missingInAPI, codeCount: codeHolidays.length, apiCount: apiHolidays.length };
    }

    async function startVerification() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<p>正在验证，请稍候...</p>';
      
      let html = '';
      
      for (const country of countries) {
        html += `<div class="country-section"><h2>${country.displayName} (${country.code})</h2>`;
        
        for (const year of years) {
          html += `<div class="year-section"><h3>${year}年</h3>`;
          
          const apiHolidays = await fetchHolidaysFromAPI(country.code, year);
          if (!apiHolidays) {
            html += `<p class="status missing">❌ 无法从API获取数据</p></div>`;
            continue;
          }
          
          const config = HOLIDAY_CONFIG[country.name];
          if (!config) {
            html += `<p class="status missing">❌ 代码中未找到配置</p></div>`;
            continue;
          }
          
          const codeHolidays = expandRecurringHolidays(config, year);
          const comparison = compareHolidays(codeHolidays, apiHolidays);
          
          html += `<p>代码中的节假日数量: <strong>${comparison.codeCount}</strong></p>`;
          html += `<p>API中的节假日数量: <strong>${comparison.apiCount}</strong></p>`;
          html += `<p>匹配的节假日数量: <strong>${comparison.matching.length}</strong></p>`;
          
          if (comparison.missingInCode.length > 0) {
            html += `<p class="status warning">⚠️ 代码中缺失的节假日 (${comparison.missingInCode.length}个):</p>`;
            html += `<div class="holiday-list">`;
            comparison.missingInCode.forEach(h => {
              html += `<div class="holiday-item">- ${h.date}: ${h.label}</div>`;
            });
            html += `</div>`;
          }
          
          if (comparison.missingInAPI.length > 0) {
            html += `<p class="status warning">⚠️ API中缺失的节假日 (${comparison.missingInAPI.length}个):</p>`;
            html += `<div class="holiday-list">`;
            comparison.missingInAPI.forEach(h => {
              html += `<div class="holiday-item">- ${h.date}: ${h.label}</div>`;
            });
            html += `</div>`;
          }
          
          if (comparison.missingInCode.length === 0 && comparison.missingInAPI.length === 0) {
            html += `<p class="status match">✅ 完全匹配！</p>`;
          }
          
          html += `</div>`;
        }
        
        html += `</div>`;
      }
      
      resultsDiv.innerHTML = html;
    }
  </script>
</body>
</html>

